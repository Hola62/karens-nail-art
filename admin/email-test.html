<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmailJS Configuration Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .test-box {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .success {
            color: green;
        }

        .error {
            color: red;
        }

        .info {
            color: blue;
        }

        button {
            background: #3e1f0e;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #5a2f1e;
        }

        pre {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <h1>üìß EmailJS Configuration Test</h1>

    <div class="test-box">
        <h2>Step 1: Check Files Loading</h2>
        <div id="fileCheck">Checking...</div>
    </div>

    <div class="test-box">
        <h2>Step 2: EmailJS Configuration</h2>
        <div id="configCheck">Checking...</div>
    </div>

    <div class="test-box">
        <h2>Step 3: Send Test Email</h2>
        <p>Enter your email to receive a test message:</p>
        <input type="email" id="testEmail" placeholder="your-email@example.com" style="padding: 8px; width: 300px;">
        <button onclick="sendTestEmail()">Send Test Email</button>
        <div id="sendResult" style="margin-top: 10px;"></div>
    </div>

    <div class="test-box">
        <h2>Debug Information</h2>
        <pre id="debugInfo"></pre>
    </div>

    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <!-- Email Config -->
    <script src="../js/email-config.js"></script>

    <script>
        // Check 1: Files loaded
        let fileCheckHtml = '';
        if (typeof emailjs !== 'undefined') {
            fileCheckHtml += '<p class="success">‚úÖ EmailJS library loaded</p>';
        } else {
            fileCheckHtml += '<p class="error">‚ùå EmailJS library NOT loaded</p>';
        }

        if (typeof window.EMAIL_SETTINGS !== 'undefined') {
            fileCheckHtml += '<p class="success">‚úÖ email-config.js loaded</p>';
        } else {
            fileCheckHtml += '<p class="error">‚ùå email-config.js NOT loaded</p>';
        }
        document.getElementById('fileCheck').innerHTML = fileCheckHtml;

        // Check 2: Configuration
        let configCheckHtml = '';
        if (window.EMAIL_SETTINGS) {
            if (window.EMAIL_SETTINGS.serviceId) {
                configCheckHtml += '<p class="success">‚úÖ Service ID: ' + window.EMAIL_SETTINGS.serviceId + '</p>';
            } else {
                configCheckHtml += '<p class="error">‚ùå Service ID missing</p>';
            }

            if (window.EMAIL_SETTINGS.templateId) {
                configCheckHtml += '<p class="success">‚úÖ Template ID: ' + window.EMAIL_SETTINGS.templateId + '</p>';
            } else {
                configCheckHtml += '<p class="error">‚ùå Template ID missing</p>';
            }

            if (window.EMAIL_SETTINGS.publicKey) {
                configCheckHtml += '<p class="success">‚úÖ Public Key: ' + window.EMAIL_SETTINGS.publicKey.substring(0, 10) + '...</p>';
            } else {
                configCheckHtml += '<p class="error">‚ùå Public Key missing</p>';
            }

            if (window.EMAIL_SETTINGS.fromEmail) {
                configCheckHtml += '<p class="success">‚úÖ From Email: ' + window.EMAIL_SETTINGS.fromEmail + '</p>';
            }

            // Initialize EmailJS
            try {
                emailjs.init(window.EMAIL_SETTINGS.publicKey);
                configCheckHtml += '<p class="success">‚úÖ EmailJS initialized successfully</p>';
            } catch (e) {
                configCheckHtml += '<p class="error">‚ùå EmailJS initialization failed: ' + e.message + '</p>';
            }
        } else {
            configCheckHtml += '<p class="error">‚ùå EMAIL_SETTINGS not found</p>';
        }
        document.getElementById('configCheck').innerHTML = configCheckHtml;

        // Debug info
        let debugInfo = {
            'EmailJS Loaded': typeof emailjs !== 'undefined',
            'Config Loaded': typeof window.EMAIL_SETTINGS !== 'undefined',
            'Service ID': window.EMAIL_SETTINGS?.serviceId || 'NOT SET',
            'Template ID': window.EMAIL_SETTINGS?.templateId || 'NOT SET',
            'Public Key': window.EMAIL_SETTINGS?.publicKey ? 'SET' : 'NOT SET',
            'From Email': window.EMAIL_SETTINGS?.fromEmail || 'NOT SET',
            'Current URL': window.location.href
        };
        document.getElementById('debugInfo').textContent = JSON.stringify(debugInfo, null, 2);

        // Send test email
        async function sendTestEmail() {
            const email = document.getElementById('testEmail').value.trim();
            const resultDiv = document.getElementById('sendResult');

            if (!email) {
                resultDiv.innerHTML = '<p class="error">Please enter an email address</p>';
                return;
            }

            if (!window.EMAIL_SETTINGS) {
                resultDiv.innerHTML = '<p class="error">‚ùå Email settings not configured</p>';
                return;
            }

            if (!window.emailjs) {
                resultDiv.innerHTML = '<p class="error">‚ùå EmailJS library not loaded</p>';
                return;
            }

            resultDiv.innerHTML = '<p class="info">Sending test email...</p>';

            try {
                const params = {
                    to_email: email,
                    to_name: email.split('@')[0],
                    from_name: window.EMAIL_SETTINGS.fromName,
                    reply_to: window.EMAIL_SETTINGS.fromEmail,
                    subject: 'Test Email from Karen\'s Nail Art',
                    message: 'This is a test email to verify EmailJS configuration is working correctly!'
                };

                const response = await emailjs.send(
                    window.EMAIL_SETTINGS.serviceId,
                    window.EMAIL_SETTINGS.templateId,
                    params
                );

                resultDiv.innerHTML = '<p class="success">‚úÖ Test email sent successfully! Check your inbox.</p><pre>' + JSON.stringify(response, null, 2) + '</pre>';
            } catch (error) {
                console.error('Send error:', error);
                resultDiv.innerHTML = '<p class="error">‚ùå Failed to send: ' + (error.text || error.message || JSON.stringify(error)) + '</p>';
            }
        }
    </script>
</body>

</html>